<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Planificateur d'Interventions - Assemblées de Dieu</title>
    <link rel="icon" href="AD.jpeg" type="image/jpeg">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body class="theme-light">
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container-fluid d-flex align-items-center">
            <a class="navbar-brand" href="#">
                <img src="AD.jpeg" alt="Logo AD" class="img-fluid" style="width: 80px; height: 80px; object-fit: contain; border-radius: 8px; margin-right: 15px;">
                <span class="glow-text">Planificateur d'Interventions</span>
            </a>

            <div class="theme-selector">
                <div class="theme-btn theme-light-btn" title="Clair" onclick="changeTheme('light')"></div>
                <div class="theme-btn theme-dark-btn" title="Sombre" onclick="changeTheme('dark')"></div>
                <div class="theme-btn theme-neon-btn" title="Néon" onclick="changeTheme('neon')"></div>
                <div class="theme-btn theme-galaxy-btn" title="Galaxie" onclick="changeTheme('galaxy')"></div>
                <div class="theme-btn theme-rainbow-btn" title="Arc-en-ciel" onclick="changeTheme('rainbow')"></div>
                <div class="theme-btn theme-high-contrast-btn" title="Contraste élevé" onclick="changeTheme('high-contrast')">HC</div>
                <div class="theme-btn theme-pastel-btn" title="Pastel" onclick="changeTheme('pastel')">P</div>
            </div>

            <div class="navbar-text me-3">
                <span class="badge bg-warning text-dark">Église BERACA</span>
            </div>

            <div class="ms-3">
                <button class="btn btn-outline-info" id="help-btn" title="Aide">
                    <i class="fas fa-question-circle"></i>
                </button>
            </div>

            <div class="dropdown">
                <button class="btn btn-outline-secondary dropdown-toggle" type="button" id="languageDropdown" data-bs-toggle="dropdown">
                    <i class="fas fa-globe me-1"></i>FR
                </button>
                <ul class="dropdown-menu">
                    <li><a class="dropdown-item" href="#" onclick="changeLanguage('fr')">Français</a></li>
                    <li><a class="dropdown-item" href="#" onclick="changeLanguage('en')">English</a></li>
                </ul>
            </div>

            <div class="ms-3">
                <button class="btn btn-outline-warning" id="logout-btn" title="Déconnexion administrateur">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <!-- En-tête AD -->
        <div class="ad-header">
            <h1><i class="fas fa-church me-2"></i>ASSEMBLÉES DE DIEU DU BÉNIN</h1>
            <p>Plan d'Action Trimestriel - Gestion des Interventions</p>
        </div>

        <!-- Cartes d'options -->
        <div class="row mt-5">
            <div class="col-md-6 mb-4">
                <div class="card main-card h-100">
                    <div class="card-body text-center">
                        <div class="card-icon mb-4">
                            <i class="fas fa-calendar-alt fa-3x text-primary"></i>
                        </div>
                        <h4 class="card-title">Planification</h4>
                        <p class="card-text">Créer et gérer les interventions planifiées</p>
                        <button class="btn btn-primary btn-lg" id="access-planning-btn">
                            <i class="fas fa-edit me-2"></i>Accéder à la planification
                        </button>
                    </div>
                </div>
            </div>
            <div class="col-md-6 mb-4">
                <div class="card main-card h-100">
                    <div class="card-body text-center">
                        <div class="card-icon mb-4">
                            <i class="fas fa-chart-bar fa-3x text-success"></i>
                        </div>
                        <h4 class="card-title">Rapport</h4>
                        <p class="card-text">Visualiser et exporter les interventions</p>
                        <a href="rapport.html" class="btn btn-success btn-lg">
                            <i class="fas fa-file-alt me-2"></i>Accéder au rapport
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Section pour les liens de publication -->
        <div class="card main-card mt-5">
            <div class="card-header">
                <h4><i class="fas fa-link me-2"></i>Accès aux publications</h4>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-8">
                        <p>Entrez un lien de publication pour accéder à des données partagées :</p>
                        <div class="input-group">
                            <input type="text" class="form-control" id="publish-link-input" placeholder="Collez le lien de publication ici...">
                            <button class="btn btn-primary" type="button" id="access-publish-link">
                                <i class="fas fa-external-link-alt me-2"></i>Accéder
                            </button>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <p class="text-center">Ou utilisez directement l'URL :</p>
                        <p class="text-center">
                            <code>rapport.html?data=...</code>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Charger les données sauvegardées
        document.addEventListener('DOMContentLoaded', function() {
            // Charger le thème sauvegardé
            const savedTheme = localStorage.getItem('selectedTheme') || 'light';
            changeTheme(savedTheme);
            
            // Configurer les événements
            setupAccueilEventListeners();
        });

        function setupAccueilEventListeners() {
            document.getElementById('access-publish-link').addEventListener('click', function() {
                const link = document.getElementById('publish-link-input').value;
                if (link) {
                    // Extraire le paramètre data de l'URL
                    const url = new URL(link);
                    const dataParam = url.searchParams.get('data');
                    
                    if (dataParam) {
                        // Rediriger vers la page de rapport avec les données
                        window.location.href = `rapport.html?data=${dataParam}`;
                    } else {
                        alert('Lien de publication invalide. Veuillez vérifier le format du lien.');
                    }
                } else {
                    alert('Veuillez entrer un lien de publication.');
                }
            });
            
            document.getElementById('help-btn').addEventListener('click', function() {
                alert('Bienvenue dans le Planificateur d\'Interventions des Assemblées de Dieu du Bénin. Utilisez les cartes ci-dessus pour accéder aux différentes fonctionnalités.');
            });
        }

        function changeTheme(theme) {
            // Valider que le thème est autorisé pour éviter les injections CSS
            const allowedThemes = ['light', 'dark', 'neon', 'galaxy', 'rainbow', 'high-contrast', 'pastel'];
            if (!allowedThemes.includes(theme)) {
                console.warn(`Thème non autorisé : ${theme}`);
                return;
            }

            document.body.className = 'theme-' + theme;
            
            // Sauvegarder le thème sélectionné
            localStorage.setItem('selectedTheme', theme);
        }

        function changeLanguage(lang) {
            // Cette fonction est conservée pour la compatibilité avec l'interface
            localStorage.setItem('selectedLanguage', lang);
            alert('La langue a été changée en ' + (lang === 'fr' ? 'Français' : 'English'));
        }

        // Fonction pour vérifier l'accès à la planification
        function checkAccess() {
            // Vérifier si l'utilisateur est déjà authentifié
            const isAuthenticated = localStorage.getItem('adminAccess') === 'true';

            if (isAuthenticated) {
                // Accès direct si déjà authentifié
                window.location.href = 'index.html';
                return;
            }

            const adminCode = 'BeraComi26';
            const enteredCode = prompt('Veuillez entrer le code administrateur pour accéder à la planification :');

            if (enteredCode === adminCode) {
                // Stocker l'état d'authentification
                localStorage.setItem('adminAccess', 'true');
                // Rediriger vers la page de planification
                window.location.href = 'index.html';
            } else if (enteredCode !== null) {
                alert('Code administrateur incorrect. Accès refusé.');
            }
            // Si l'utilisateur annule, ne rien faire
        }

        // Fonction pour vérifier l'authentification sur la page de planification
        function checkPlanificationAccess() {
            const isAuthenticated = localStorage.getItem('adminAccess') === 'true';

            if (!isAuthenticated) {
                // Rediriger vers la page d'accueil si non authentifié
                alert('Accès refusé. Veuillez vous authentifier sur la page d\'accueil.');
                window.location.href = 'accueil.html';
                return false;
            }
            return true;
        }

        // Configurer le bouton d'accès à la planification
        document.getElementById('access-planning-btn').addEventListener('click', checkAccess);

        // Configurer le bouton de déconnexion
        document.getElementById('logout-btn').addEventListener('click', function() {
            if (confirm('Êtes-vous sûr de vouloir vous déconnecter ? Cela supprimera votre accès administrateur.')) {
                localStorage.removeItem('adminAccess');
                alert('Vous avez été déconnecté avec succès.');
            }
        });
    </script>
</body>
</html>